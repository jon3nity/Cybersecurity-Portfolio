# Malware / C2 Containment Response Playbook

**Playbook ID:** IR-002  
**MITRE ATT&CK:** T1071.001 (Web C2), T1071.004 (DNS C2), T1573 (Encrypted Channel)  
**Severity:** CRITICAL  
**Last Updated:** February 2026  
**Author:** John Onyekachi, MSc Cybersecurity

---

## 1. Overview

This playbook covers the response to confirmed or suspected command-and-control (C2) activity from an internal host. C2 beaconing indicates an attacker has already compromised a system and is maintaining remote access — this is a high-urgency incident requiring immediate containment.

---

## 2. Alert Trigger Conditions

- Regular-interval HTTP callbacks to an uncommon external domain (jitter ratio < 0.3)
- DNS queries with abnormally long subdomains (>20 chars) to a single domain
- HTTP POST to known C2 infrastructure or newly registered domains
- Correlation: C2 beaconing detected from a host previously flagged for brute force compromise

---

## 3. Triage (First 10 Minutes)

### 3.1 Confirm the C2 Indicator

1. Review the beacon pattern: Is the interval consistent? (C2 beacons are notably regular)
2. Check the destination domain against threat intelligence (VirusTotal, AbuseIPDB, OTX)
3. Examine the HTTP request: unusual User-Agent, encoded POST body, small response sizes
4. For DNS tunneling: Check subdomain entropy and query volume

### 3.2 SPL Investigation Queries

**Identify beaconing pattern:**
```
index=attack_sim src_ip="<INFECTED_HOST_IP>" dst_ip="<C2_IP>"
| sort _time
| streamstats current=f last(_time) AS prev_time
| eval interval = _time - prev_time
| stats count, avg(interval) AS avg_int, stdev(interval) AS stdev_int,
    values(domain) AS domains
| eval jitter = round(stdev_int / avg_int, 3)
```

**Check all hosts communicating with the C2 domain:**
```
index=attack_sim domain="<C2_DOMAIN>"
| stats dc(src_ip) AS infected_hosts, values(src_ip) AS host_list,
    count AS total_callbacks BY domain
```

**Look for data exfiltration from the infected host:**
```
index=attack_sim src_ip="<INFECTED_HOST_IP>" bytes_out>0
| eval mb = round(bytes_out/1048576, 2)
| stats sum(mb) AS total_mb_exfil, count AS transfers BY domain
| where total_mb_exfil > 1
| sort -total_mb_exfil
```

### 3.3 Determine Scope

- How many internal hosts are beaconing to the same C2?
- How long has the beaconing been active? (Check historical logs)
- Is data being exfiltrated alongside the C2 traffic?
- Has the attacker moved laterally from the infected host?

---

## 4. Containment (10–45 Minutes)

### 4.1 Network Containment

**Immediate (within 10 minutes):**

1. Block the C2 domain and IP at the DNS sinkhole and firewall
2. Add the C2 indicators to the organization's threat intelligence feed
3. If multiple hosts are infected, block at the proxy/firewall level rather than per-host

### 4.2 Host Containment

**Immediate:**

4. Isolate the infected host from the network (disable NIC or move to quarantine VLAN)
5. Do NOT power off — preserve volatile memory for forensics
6. Disable the user account associated with the infected host

**If lateral movement is confirmed:**

7. Isolate all hosts the infected machine authenticated to
8. Force password resets for all accounts used from the infected host
9. Revoke any VPN/remote access tokens

---

## 5. Investigation (1–4 Hours)

### 5.1 Host Forensics

1. Capture memory dump before any remediation (volatility framework)
2. Collect running process list, network connections, scheduled tasks
3. Check for persistence: startup items, cron jobs, registry run keys, WMI subscriptions
4. Identify the malware binary (hash it, submit to VirusTotal/sandbox)
5. Determine initial infection vector (phishing email, drive-by download, exploit)

### 5.2 Network Forensics

6. Extract full PCAP of C2 communications if available
7. Analyze beacon payload contents for commands received
8. Check for additional C2 channels (backup domains, fallback IPs)
9. Quantify data exfiltrated based on bytes_out over the C2 period

### 5.3 Scope Expansion Check

10. Search all internal hosts for the same C2 indicators (domain, IP, User-Agent hash)
11. Check if the malware has self-propagation capabilities
12. Review email logs for phishing campaigns that may have targeted multiple users

---

## 6. Eradication

1. Remove the malware binary and all associated files
2. Remove persistence mechanisms (scheduled tasks, services, registry keys)
3. Remove any attacker-created user accounts or SSH keys
4. Patch the vulnerability used for initial access (if identified)
5. Reset credentials for all accounts that were active on the infected host
6. Update antivirus/EDR signatures with the malware hash

---

## 7. Recovery

1. Reimage the infected host from a known-good baseline if full cleanup cannot be verified
2. Restore from backup if data was corrupted or encrypted
3. Reconnect to the network with enhanced monitoring for 7 days
4. Verify C2 traffic has stopped via continuous Splunk monitoring
5. Confirm all other potentially-infected hosts are clean

---

## 8. Post-Incident

### 8.1 Detection Improvements

- Add the C2 domain pattern to a watchlist for future detection
- Tune beaconing detection thresholds based on observed intervals
- Implement JA3/JA3S fingerprinting if not already deployed
- Add DNS query length monitoring as a standard detection
- Consider deploying DNS response policy zones (RPZ) for known-bad domains

### 8.2 Prevention Improvements

- Review email filtering rules (if phishing was the vector)
- Implement application whitelisting on critical servers
- Deploy network segmentation to limit lateral movement
- Enable enhanced PowerShell logging (Script Block Logging, Module Logging)

### 8.3 Incident Report

Document: full timeline, IOCs (hashes, domains, IPs), affected hosts and accounts, data impact assessment, root cause, remediation steps, and recommendations.

---

## 9. IOC Collection Template

| IOC Type | Value | Context |
|----------|-------|---------|
| Domain | | C2 callback domain |
| IP Address | | C2 server IP |
| URL Path | | Beacon URI |
| File Hash (SHA256) | | Malware binary |
| User-Agent | | C2 beacon identifier |
| DNS Pattern | | Subdomain encoding pattern |
| Beacon Interval | | Seconds between callbacks |

---

## 10. References

- MITRE ATT&CK T1071: https://attack.mitre.org/techniques/T1071/
- MITRE ATT&CK T1573: https://attack.mitre.org/techniques/T1573/
- CISA C2 Detection Guide: https://www.cisa.gov/
- Mandiant APT C2 Analysis methodologies
